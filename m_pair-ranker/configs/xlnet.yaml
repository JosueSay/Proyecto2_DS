# modelo base
model:
  name: xlnet-base-cased
  pretrained_name: xlnet-base-cased
  dropout: 0.20
  grad_checkpointing: false
  compile: false

# longitudes de entrada
lengths:
  max_len_prompt: 96
  max_len_resp: 320

# entrenamiento
train:
  epochs: 8
  batch_size: 6
  grad_accum: 3
  lr: 8e-6
  weight_decay: 0.01
  warmup_ratio: 0.10
  scheduler: cosine
  clip_norm: 2.0
  seed: 42
  amp: "false"
  num_workers: 8

# datos
data:
  train_csv: data/clean/train_strat.csv
  valid_csv: data/clean/valid_strat.csv
  use_label: true
  use_clean_cols: true
  shuffle: true
  val_batch_size: 24
  pin_memory: true
  prompt_col: prompt_clean
  respA_col: response_a_clean
  respB_col: response_b_clean

# dataloader
dataloader:
  prefetch_factor_train: 4
  prefetch_factor_val: 4
  persistent_workers: true

# pérdida y regularización
loss:
  type: "bradley_terry"
  label_smoothing: 0.10
  class_weights: [1.0, 1.0, 2.1]

# evaluación e inferencia
eval:
  bt_temp: 0.85
  tie_tau: 0.70
  tie_alpha: 0.85

# logging y salidas
logging:
  reports_dir: reports/xlnet
  runs_dir: results/xlnet
  step_csv: steps.csv
  epoch_csv: epochs.csv
  alerts_csv: alerts.csv
  confusion_csv: confusion.csv
  class_report_csv: class_report.csv
  preds_sample_csv: preds.csv
  pred_distributions_csv: pred_distributions.csv
  val_pred_tpl: val_predictions_epoch_{:02}.csv
  token_budget_tpl: token_budget_epoch_{:02}.csv
  run_config_used: run_config_used.yaml
  step_interval: 200

# monitoreo/checkpoints
monitor:
  detect_collapse: true
  save_best_by: macro_f1
  save_last: true
  verbose: true

# early stopping
early_stopping:
  metric: macro_f1
  mode: max
  patience: 3

# entorno
env:
  tokenizers_parallelism: true
  cuda_launch_blocking: 0
  pytorch_cuda_alloc_conf: "max_split_size_mb:128"
  hf_home: ".hf_cache"
  use_slow_tokenizer: true
